<div class="container">
    <h1><i class="fas fa-receipt"></i> Receipts</h1>
    <div class="full-line"></div>
    <% if (purchases && purchases.length > 0) { %>
      <h2 class="text-2xl font-bold text-center text-gray-700 my-8"><i class="fas fa-list"></i> Purchase Summary</h2>

      <div class="overflow-x-auto shadow-md sm:rounded-lg">
        <table class="w-full text-sm text-left text-gray-500">
          <thead class="text-xs text-gray-700 uppercase bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3"><i class="fas fa-pills"></i> Medicine</th>
              <th scope="col" class="px-6 py-3 text-center"><i class="fas fa-hashtag"></i> Tablets Bought</th>
              <th scope="col" class="px-6 py-3 text-center"><i class="fas fa-rupee-sign"></i> Price per Tablet</th>
              <th scope="col" class="px-6 py-3 text-center"><i class="fas fa-calculator"></i> Total</th>
            </tr>
          </thead>
          <tbody>
            <% purchases.forEach((purchase, index) => { %>
              <tr class="bg-white border-b hover:bg-gray-50">
                <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap"><%= purchase.medicine %></td>
                <td class="px-6 py-4 text-center"><%= purchase.quantity %></td>
                <td class="px-6 py-4 text-center">₹<%= purchase.pricePerTablet.toFixed(2) %></td>
                <td class="px-6 py-4 text-center font-semibold">₹<%= purchase.total.toFixed(2) %></td>
              </tr>
            <% }); %>
            <tr class="bg-gray-100 font-semibold text-gray-900">
              <td colspan="3" class="px-6 py-4 text-right">Subtotal:</td>
              <td class="px-6 py-4 text-center">₹<%= grandTotal.toFixed(2) %></td>
            </tr>
            <% if (discountPercent > 0) { %>
            <tr class="bg-gray-100 font-semibold text-gray-900">
              <td colspan="3" class="px-6 py-4 text-right">Discount (<%= discountPercent %>%):</td>
              <td class="px-6 py-4 text-center">-₹<%= discountAmount.toFixed(2) %></td>
            </tr>
            <% } %>
            <tr class="bg-gray-200 font-bold text-gray-900 text-base">
              <td colspan="3" class="px-6 py-4 text-right">Total Amount:</td>
              <td class="px-6 py-4 text-center">₹<%= discountedTotal.toFixed(2) %></td>
            </tr>
          </tbody>
        </table>
      </div>

      <form action="/generate-receipts" method="POST" class="text-center my-8">
        <label for="patientName" class="font-bold"><i class="fas fa-user"></i> Patient Name:</label>
        <input type="text" name="patientName" id="patientName" placeholder="Enter patient name (optional)" class="mt-2 px-4 py-2 border rounded-md">
        <br>
        <button type="submit" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"><i class="fas fa-check"></i> Generate Report</button>
      </form>

      <% if (generated) { %>
        <div class="text-center mt-4">
          <p class="text-green-600 font-semibold">Report generated</p>
        </div>

        <div class="text-center mt-4">
          <button onclick="printReceipt()" class="text-blue-600 hover:underline mr-4">
            <i class="fas fa-print"></i> Print Report
          </button>
          <a href="/download-pdf" class="text-blue-600 hover:underline">
            <i class="fas fa-download"></i> Download PDF
          </a>
        </div>
      <% } %>

      <script>
        function printReceipt() {
          // Open the PDF in a new window and print it
          const printWindow = window.open('/download-pdf', '_blank');
          setTimeout(() => {
            printWindow.print();
          }, 1000); // Wait for PDF to load before printing
        }
      </script>
    <% } %>
    <div class="text-center mt-8">
      <a href="/view-dashboard?clear=true" class="inline-block px-6 py-3 bg-green-600 text-white rounded-full font-semibold hover:bg-green-700 transition-colors">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>
  </div>